<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ADLS File Upload</title>
<style>
    body { font-family: Arial, sans-serif; margin: 40px; background-color: #f4f4f4; }
    h1 { color: #333; }
    form { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input[type="file"], input[type="text"], input[type="email"] { margin-bottom: 10px; width: 100%; padding: 8px; }
    button { padding: 10px 20px; background-color: #007bff; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background-color: #0056b3; }
    #status { margin-top: 20px; font-weight: bold; }
    #downloadLink { margin-top: 20px; display: none; font-size: 16px; }
</style>
</head>
<body>
<h1>ADLS File Upload</h1>
<form id="uploadForm">
    <label>Select Input File:</label><br/>
    <input type="file" id="inputFile" required /><br/>

    <!-- Optional parameters (not required for now) -->
    <label>Parameter (RC/ACCT/ENTY):</label><br/>
    <input type="text" id="param" placeholder="Parameter value" /><br/>

    <label>Request Type (New/Rename/Remove):</label><br/>
    <input type="text" id="requestType" placeholder="Request type" /><br/>

    <label>ServiceNow Incident Number:</label><br/>
    <input type="text" id="servicenowIncident" placeholder="Incident Number" /><br/>

    <label>Email ID:</label><br/>
    <input type="email" id="emailId" placeholder="your.email@example.com" /><br/>

    <button type="submit">Upload File</button>
</form>

<div id="status"></div>
<a id="downloadLink" href="#" download>Download Uploaded File</a>

<script>
const containerSasUrl = "https://fsvnadls2uset2satadf.blob.core.windows.net/test1?sv=2024-11-04&ss=bfqt&srt=sco&sp=rcw&st=2025-08-22T09:42:58Z&se=2025-08-29T17:57:58Z&sig=06AgVOHsEEND%2FCX5jMT175Yx9k8QRdpWm%2Bvj3v0xWAk%3D";

// Fixed folder path inside container
const folderPath = "Steiney/AI/Dops/RC/test_copy";

document.getElementById('uploadForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const statusDiv = document.getElementById('status');
    const downloadLink = document.getElementById('downloadLink');

    statusDiv.innerHTML = 'Uploading file...';

    const fileInput = document.getElementById('inputFile');

    if (fileInput.files.length === 0) {
        alert('Please select a file.');
        return;
    }

    const file = fileInput.files[0];

    const filename = file.name;
    const encodedFilename = encodeURIComponent(filename);

    // Construct the full URL to upload into the fixed folder
    const fullUrl = `${containerSasUrl.split('?')[0]}/${folderPath}/${encodedFilename}?${containerSasUrl.split('?')[1]}`;

    // Upload the file directly
    fetch(fullUrl, {
        method: 'PUT',
        headers: { 'x-ms-blob-type': 'BlockBlob' },
        body: file
    }).then(res => {
        if (res.ok || res.status === 201) {
            statusDiv.innerHTML = 'Upload successful!';
            // Show download link
            document.getElementById('downloadLink').href = fullUrl.split('?')[0];
            document.getElementById('downloadLink').style.display = 'block';
        } else {
            statusDiv.innerHTML = 'Upload failed: ' + res.statusText;
        }
    }).catch(err => {
        statusDiv.innerHTML = 'Error: ' + err.message;
    });
});
</script>
</body>
</html>
